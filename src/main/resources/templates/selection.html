<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>SSGC Field Activity Reporting System (FARS)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
<style>
/* Background */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #0073e6, #004494);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 30px;
  color: #333;
  animation: fadeIn 1.2s ease-in-out;
}

/* Container Card */
.container {
  width: 100%;
  max-width: 1100px;
  background: #ffffff;
  padding: 30px 35px;
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.2);
  animation: slideUp 1s ease-out;
}

/* Header */
.header {
  text-align: center;
  margin-bottom: 25px;
}
.header img {
  height: 55px;
  margin-bottom: 12px;
  animation: zoomIn 1s ease-in-out;
}
.header h1 {
  margin: 0;
  font-size: 28px;
  font-weight: bold;
  color: #004494;
}
.header h2 {
  margin: 6px 0 0;
  font-size: 20px;
  font-weight: 600;
  color: #0073e6;
}

/* Form Rows */
.form-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  margin-bottom: 20px;
}
.form-group {
  display: flex;
  flex-direction: column;
}
label {
  font-weight: 600;
  margin-bottom: 6px;
  color: #444;
}
input, select {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
  transition: border-color 0.2s, box-shadow 0.2s;
}
input:focus, select:focus {
  outline: none;
  border-color: #0073e6;
  box-shadow: 0 0 5px rgba(0,115,230,0.4);
}

/* Buttons */
button {
  width: 100%;
  padding: 14px;
  background: linear-gradient(90deg, #0073e6, #004494);
  color: #fff;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: 0.3s;
  font-size: 15px;
  font-weight: bold;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
button:hover {
  background: linear-gradient(90deg, #005bb5, #003366);
  transform: translateY(-1px);
}
button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Message */
#message {
  margin-top: 15px;
  font-size: 14px;
  text-align: center;
}

/* Logout button (top-right) */
.logout-container {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 10px;
}
.logout-btn {
  background: #e63946;
  padding: 10px 18px;
  border-radius: 8px;
  color: white;
  font-size: 14px;
  font-weight: bold;
  border: none;
  cursor: pointer;
  transition: 0.3s;
}
.logout-btn:hover {
  background: #b71c1c;
  transform: scale(1.05);
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
@keyframes slideUp {
  from { transform: translateY(50px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
@keyframes zoomIn {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
</style>
</head>
<body>
<div class="container">
  
  <!-- Logout Button -->
  <div class="logout-container">
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

  <!-- Header -->
  <div class="header">
    <img src="/image.png" alt="My Image">
    <h1>SSGC Field Activity Reporting System (FARS)</h1>
    <h2>Field Activity Lookup</h2>
  </div>

  <!-- Form -->
  <form id="filterForm" onsubmit="event.preventDefault(); lookupDetails();">
    <div class="form-row">
      <div class="form-group"><label>Account ID</label><input type="text" id="accountId" placeholder="Enter Account ID"></div>
      <div class="form-group"><label>Area</label><select id="area"><option value="">-- Select Area --</option></select></div>
    </div>

    <div class="form-row">
      <div class="form-group"><label>Unit</label><select id="unit"><option value="">-- Select Unit --</option></select></div>
      <div class="form-group"><label>Field Activity</label><select id="activity"><option value="">-- Select Activity --</option></select></div>
    </div>

    <div class="form-row">
      <div class="form-group"><label>Region</label><select id="region"><option value="">-- Select Region --</option></select></div>
      <div class="form-group"><label>FA Status</label><select id="faStatus"><option value="">-- Select Status --</option></select></div>
    </div>

    <div class="form-row">
      <div class="form-group"><label>Zone</label><select id="zone"><option value="">-- Select Zone --</option></select></div>
      <div class="form-group"><label>Date From</label><input type="date" id="dateFrom"></div>
    </div>

    <div class="form-row">
      <div class="form-group"><label>Subzone</label><select id="subzone"><option value="">-- Select Subzone --</option></select></div>
      <div class="form-group"><label>Date To</label><input type="date" id="dateTo"></div>
    </div>

    <button type="submit" id="lookupBtn">Lookup Details</button>
    <div id="message"></div>
  </form>
</div>

<script>
/* --- Existing JS untouched --- */
const API_LOCATIONS = "/api/locations";
const API_ACTIVITIES = "/api/activities/types";
const API_STATUS = "/api/activities/statuses";
const labels = { unit:"Unit", region:"Region", zone:"Zone", subzone:"Subzone", area:"Area", activity:"Field Activity", faStatus:"FA Status" };

const fillDropdown = (id, data) => {
    const dd = document.getElementById(id);
    dd.innerHTML = `<option value="">-- Select ${labels[id] || id} --</option>`;
    if(Array.isArray(data)) data.forEach(v => dd.innerHTML += `<option value="${v}">${v}</option>`);
};
const clearDropdowns = (ids) => ids.forEach(id => document.getElementById(id).innerHTML = `<option value="">-- Select ${labels[id] || id} --</option>`);
const showMessage = (txt, error=false) => {
    const m = document.getElementById("message");
    m.textContent = txt;
    m.style.color = error ? "red" : "#333";
};

async function loadUnits() {
    try {
        const res = await fetch(`${API_LOCATIONS}/units`);
        fillDropdown('unit', await res.json());
    } catch(e) { console.error(e); showMessage("Error loading units", true); }
}
loadUnits();

fetch(API_ACTIVITIES)
  .then(res => res.json())
  .then(data => fillDropdown('activity', data))
  .catch(e => { console.error(e); showMessage("Error loading activities", true); });

fetch(API_STATUS)
  .then(res => res.json())
  .then(data => fillDropdown('faStatus', data))
  .catch(e => { console.error(e); showMessage("Error loading FA Status", true); });

document.getElementById('unit').addEventListener('change', async () => {
    const unit = document.getElementById('unit').value.trim();
    clearDropdowns(['region','zone','subzone','area']);
    if(!unit) return;
    const res = await fetch(`${API_LOCATIONS}/regions/${encodeURIComponent(unit)}`);
    fillDropdown('region', await res.json());
});

document.getElementById('region').addEventListener('change', async () => {
    const region = document.getElementById('region').value.trim();
    clearDropdowns(['zone','subzone','area']);
    if(!region) return;
    const res = await fetch(`${API_LOCATIONS}/zones/${encodeURIComponent(region)}`);
    fillDropdown('zone', await res.json());
});

document.getElementById('zone').addEventListener('change', async () => {
    const zone = document.getElementById('zone').value.trim();
    clearDropdowns(['subzone','area']);
    if(!zone) return;
    const res = await fetch(`${API_LOCATIONS}/subzones/${encodeURIComponent(zone)}`);
    fillDropdown('subzone', await res.json());
});

document.getElementById('subzone').addEventListener('change', async () => {
    const subzone = document.getElementById('subzone').value.trim();
    clearDropdowns(['area']);
    if(!subzone) return;
    const res = await fetch(`${API_LOCATIONS}/areas/${encodeURIComponent(subzone)}`);
    fillDropdown('area', await res.json());
});


const toDateTimeString = (d, end=false) => d ? `${d}T${end ? '23:59:59' : '00:00:00'}` : null;

async function lookupDetails() {
    const btn = document.getElementById("lookupBtn");
    btn.disabled = true;
    showMessage('Loading...');
    const filters = {
        accountId: document.getElementById('accountId').value || null,
        unit: document.getElementById('unit').value || null,
        region: document.getElementById('region').value || null,
        zone: document.getElementById('zone').value || null,
        subzone: document.getElementById('subzone').value || null,
        area: document.getElementById('area').value || null,
        faType: document.getElementById('activity').value || null,
        faStatus: document.getElementById('faStatus').value || null,
        startDate: toDateTimeString(document.getElementById('dateFrom').value),
        endDate: toDateTimeString(document.getElementById('dateTo').value, true)
    };
    try {
        const params = new URLSearchParams();
        for(const k in filters) if(filters[k]) params.append(k, filters[k]);
        const res = await fetch(`/api/activities/search?${params.toString()}`);
        const data = await res.json();
        if(!Array.isArray(data) || !data.length) { showMessage("No records found", true); btn.disabled=false; return; }
        localStorage.setItem("reportData", JSON.stringify(data));
        window.location.href = "/result";
    } catch(e) { console.error(e); showMessage("Error fetching results", true); }
    finally { btn.disabled = false; }
}

/* Logout function */
function logout() {
  window.location.href = "/login";
}
</script>
</body>
</html>
